<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>SSPS [4102|6006] Data Analytics[in the Social Sciences|for Social Research]</title>
    <meta charset="utf-8" />
    <meta name="author" content="Francesco Bailo" />
    <script src="week-05_files/header-attrs/header-attrs.js"></script>
    <link href="week-05_files/remark-css/default.css" rel="stylesheet" />
    <script src="week-05_files/htmlwidgets/htmlwidgets.js"></script>
    <script src="week-05_files/viz/viz.js"></script>
    <link href="week-05_files/DiagrammeR-styles/styles.css" rel="stylesheet" />
    <script src="week-05_files/grViz-binding/grViz.js"></script>
    <script src="week-05_files/kePrint/kePrint.js"></script>
    <link href="week-05_files/lightable/lightable.css" rel="stylesheet" />
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } },
      });
    </script>
    <style>
    .mjx-mrow a {
      color: black;
      pointer-events: none;
      cursor: default;
    }
    </style>
    <link rel="stylesheet" href="assets/sydney-fonts.css" type="text/css" />
    <link rel="stylesheet" href="assets/sydney.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# SSPS [4102|6006] Data Analytics</br>[in the Social Sciences|for Social Research]
]
.subtitle[
## Week 05</br>Data transformation and communication with R
]
.author[
### Francesco Bailo
]
.date[
### Semester 2, 2024 (updated: 2024-08-29)
]

---


background-image: url('assets/USydLogo.svg')
background-size: 95%

&lt;style&gt;
pre {
  overflow-x: auto;
}
pre code {
  word-wrap: normal;
  white-space: pre;
}
&lt;/style&gt;



---

## Acknowledgement of Country

I would like to acknowledge the Traditional Owners of Australia and recognise their continuing connection to land, water and culture. The  University of Sydney is located on the land of the Gadigal people  of the Eora Nation. I pay my respects to their Elders, past and present.

---
background-image: url(https://www.antiprism.com/misc/tri_jit_rd01.gif)
background-size: 100%

# Data collection and tranformation 


---

## Closing the loop with Week 04 anonymous feedback

Reassure about 

- engagement 

- pace of explanation for programming concepts (introduction of new concepts will slow down drammatically)

---
class: inverse, center, middle

# Data collection

---

## Data collection (social sciences)

.pull-left[

In *research design*, **data collection** is the process of *creating* your research data. In the social sciences there are a number of methods to create interesting data sets. They can be of two types:

1. **Observational**: In an observational study, we don't influence in anyway the behaviour of the subjects of our study - who should not adapt their behavior because of or in response to our investigation. 

2. **Experimental**: In an experiment we design and control the environment where our subjects will operate. 

]

.pull-right[

.center[&lt;img src = 'https://1.bp.blogspot.com/-Pt0cQYzFA1A/Xshlv9SviGI/AAAAAAAAAmY/zEMnvw3fq_spdjYmuJ6f8t4q9q20k1kbQCLcBGAsYHQ/w490/pasteur6.gif'&gt;&lt;/img&gt;]

&lt;mark&gt;Try to classify a number of data collection instruments in **Menti**, either as Observational or Experimental...&lt;/mark&gt;

]


---

## Data collection (social sciences)

Indeed we might need to add a couple of extra types...

3. **Asking questions**: It is an type of study where we record responses and reactions to questions or other input we design through instruments of our design (online questionnaire, unstructured interview, focus group). The subject is clearly aware of the research setting and the research design should limit the impact of this awareness. 
  
4. **Quasi-experimental**: A quasi-experimental study use data recorded in a non-experimental setting. Still, these data will approximate experimental data either because of 

    1. particular events or 
    
    2. through "statistically adjusting non-experimental data in an attempt to account for preexisting differences between those who did and did not receive the treatment"&lt;sup&gt;1&lt;/sup&gt;, (for example with a technique called "matching"). 
  
.footnote[[1] Salganik, M. J. (2018). Bit by bit: Social research in the digital age. Princeton University Press.]

---

# Data collection (social sciences)

Independently of the *subject* of your data (so the WHOs your data are about), these data sets, can be

1. created directly by you (the researcher) - to which we refer to as **primary** or **first-party data**;

2. created by some other research organisation such as the ABS (**secondary** or **second-party data**); or;

3. commonly nowadays created using different second-party sources by some *data aggregating organisation* (**third-party data**).

---

## Data collection (data analytics)

In data analytics, data collection generally has a slighlty different meaning. *Data collection* refers here to the process of bringing the data into a computing environment and ready that data for the analysis. 


### Data collection in research design

<div id="htmlwidget-35f994dc398a5e37e376" style="width:100%;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-35f994dc398a5e37e376">{"x":{"diagram":"\n  digraph graph2 {\n  \n  graph [layout = dot, rankdir = LR]\n  \n  # node definitions with substituted label text\n  node [shape = oval, style = filled]\n  a [label = \"Data collection\", fillcolor = Orange]\n  b [label = \"Data\", shape = egg, fillcolor = Lightblue]\n  c [label = \"Data analysis\"]\n  d [label = \"Results\"]\n\n  \n  a -> b -> c -> d;\n  }\n  ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

### Data collection in data analytics 

<div id="htmlwidget-541892355899d5636367" style="width:100%;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-541892355899d5636367">{"x":{"diagram":"\n  digraph graph2 {\n  \n  graph [layout = dot, rankdir = LR]\n  \n  # node definitions with substituted label text\n  node [shape = oval, style = filled]\n  a [label = \"Data\", shape = egg, fillcolor = Lightblue]\n  b [label = \"Data collection\", fillcolor = Orange]\n  c [label = \"Computer\", shape = box]\n  d [label = \"Data analysis\"]\n  e [label = \"Results\"]\n\n  \n  a -> b -> c -> d -> e;\n  }\n  ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

---

## Data collection (data analytics)

.pull-left[

For data scientists, the problem is not creating the data. Data science is about existing data - not about creating new data through rigorous scientific methods. 

This doesn't mean you should not care about how the data was created in the first place. In fact, as every rigourour research you should!

But, in a data science context, the scope of the *data collection* is different from the scope of *data collection* in a social science research project.


]

.pull.right[


.center[&lt;img src = 'https://media.giphy.com/media/KzKFAvaM1RBoRU5dcl/giphy.gif'&gt;&lt;/img&gt;]

]

---

## So when data scientists talk about data collection, what do they talk about?


1. **Sourcing**: Where is the data store? How big is the data? How is structured? How can I access it (e.g. direct download, database, API)?

.center[↓]

2. **Reading in**: How do I import the data I need into my computer? You can integrally read in the data you need but sometimes you can pre-filter the data at the source with a query (e.g. with a SQL query if you are requesting data from a database or a POST query if you are requesting data from an API...)  

.center[↓]

3. **Cleaning/Preparing**: How do I prepare the data I imported for my analysis? This is about structuring the data, exactly how I need it? &lt;mark&gt;(This is what we'll discuss during the lab today...)&lt;/mark&gt;.

---

## Sourcing and Reading in

Note: Big data for computer scientists `\(\neq\)` Big data for social scientists.

When data is "small" (let's say, it can fit in a spreadsheet or can be shared via email), sourcing and reading in, is generally not a problem. For example, you can simply read your file into memory by pointing your software to that file while specifying the format:


``` r
dat &lt;- read.csv(file = "my_file.csv")
```

But when data is "big" (let's say it won't fit into your memory), you need to deal with sourcing and reading issues. 

Example of big data:

1. The text of all revisions of all pages of en.wikipedia.org;

2. All tweets with the hashtag "#metoo" published since October 2017. 

Simply put, you can't `read(source = "http://en.wikipedia.org")`.

---

## Sourcing and reading in

A detail discussion about sourcing and reading data is out of the scope of this unit. Still, as example, here an example of a common "pipeline" to collect social media data. 

<div id="htmlwidget-d51d71f00f5258bfa124" style="width:100%;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-d51d71f00f5258bfa124">{"x":{"diagram":"\n  digraph graph2 {\n  \n  graph [layout = dot, rankdir = LR]\n\n  node [shape = oval, style = filled]\n  a [label = \"Query\\nPOST /twitter/api\\n{ query : metoo, since : 20171001 }\", \n  shape = box, fillcolor = Lightblue]\n  b [label = \"API\", fillcolor = Orange, shape = egg]\n  c [label = \"Data\\njson format\"]\n  \n  d [label = \"Read json\", shape = box, fillcolor = Lightblue]\n  \n  e [label = \"Computer\", shape = box]\n\n  \n  a -> b -> c; d -> c; c -> d; d -> e;\n  }\n  ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

If instead of an API, you have a database you should expect a very similar pipeline.

&lt;/br&gt;

&lt;/br&gt;

.pull-left[
R offers a large number of tools and packages to deal about all your data sourcing and data reading issues. Yet, we will not cover them in this unit. 

But let's just quickly, talk about APIs...
]


.pull-right[
.center[&lt;img src = 'https://media.giphy.com/media/y69OrzhaWfE7frw6OI/giphy.gif' width = '55%'&gt;&lt;/img&gt;]
]

---

## What's an API again?

.center[

&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/s7wmiS2mSXY?si=btQMsQIOGlThmR8q&amp;amp;start=48" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen&gt;&lt;/iframe&gt;

]

---
class: inverse, center, middle

# Lab: Data import and export with R

---

.content-box-yellow[

There is a huge number of file formats out there. And this number is growing. Assume that if there are using the file formats, someone might have dedicated some time in writing an R function to import that data file. If you find yourself in front of a weird data format, Google is your friend!

]

## Read CSV data files (comma separated file)


``` r
my_dat &lt;- read.csv("file.csv", header = TRUE)
```

---

## Read Excel data files


``` r
library(readxl)
my_dat &lt;- readxl::read_excel("file.xlsx", sheet = 1)
```

- Note you might need to indicate which Excel sheet you need to import 

- Also, note that adding `package_name::` in front of a function


``` r
package_name::function_name()
```

is *optional*. Here I am going to often specify the `package_name::` since we are using a few. 


---

## Read SPSS data files


``` r
library(haven)
my_dat &lt;- haven::read_sav("file.sav")
```

## Read Stata data files


``` r
my_dat &lt;- haven::read_dta("file.dta")
```

---

## Write data frames to CSV


``` r
write.csv(my_dat, file = "file.csv")
```

## Write data objects using R data file formats

#### Write single objects (e.g., a data frame) to data file


``` r
saveRDS(my_obj, file = "file.rds")
```

#### Write all objects in your environment


``` r
save.image(file = "file.RData")
```


---
class: inverse, center, middle

# Lab: Data transformation with dplyr

.center[&lt;img src = 'https://media.giphy.com/media/R9zXHWAHyTjnq/giphy.gif'&gt;&lt;/img&gt;]


---


## Prerequisites&lt;sup&gt;1&lt;/sup&gt;

We are going to use these two packages:


``` r
library(nycflights13)
library(tidyverse)
```

Install them with


``` r
install.packages(c("nycflights13", "tidyverse"))
```

nycflights13 includes is a data packages (and includes the data we will use in the examples).

As mentioned last week, tidyverse is not really a package but a collection of packages...

.footnote[[1] Adapted from https://r4ds.hadley.nz/data-transform.html (Wickham &amp; Grolemund, 2023)]

---

## R's Tidyverse

.center[&lt;img src = 'https://education.rstudio.com/blog/2020/07/teaching-the-tidyverse-in-2020-part-1-getting-started/img/tidyverse-packages.png' width = "95%"&gt;&lt;/img&gt;]

Image from [Mine Çetinkaya-Rundel](https://education.rstudio.com/blog/2020/07/teaching-the-tidyverse-in-2020-part-1-getting-started/)

---

## nycflights13::flights


``` r
nycflights13::flights # (or `flights` for short)
```

```
## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ℹ 336,766 more rows
## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

## nycflights13::flights

The object `nycflights13` is not of class `data.frame` but **tibble**. We have already encountered the tibble last week. For our purposes, let's consider a tibble as a data frame (which as a matter of fact is), so a two-dimensional data objects with values ordered in rows and columns.  

In a data frame, each column can be variable of a different class (or type). We have already met a few of these types, here among the most important:

* `int` stands for **integers** (e.g. `c(1, 2, 3, 4)`).

* `dbl` stands for **doubles**, or real numbers:  (e.g. `c(1.5, 2.323132, 3.5445, 4.565)`).

* `chr` stands for **character** vectors, or strings. 

* `lgl` stands for **logical**, vectors that contain only TRUE or FALSE.

* `fctr` stands for **factors**, which R uses to represent *categorical variables* with fixed possible values.

---

## dplyr basics

dplyr is a package for manipulating data frame like objects. 

We use dplyr to manipulate **rows**, **columns** and **groups** of a data frame using specific functions (a.k.a. **verbs**).

### Rows

.content-box-yellow[

* Pick observations by their values with `filter()`.
* Reorder the rows with `arrange()`.
* Drop rows with missing values with `drop_na()`.

]

---

### Columns

.content-box-red[

* Pick variables by their names  with `select()`.
* Create new variables with functions of existing variables  with `mutate()`.
* Recode a variable with `ifelse()` or `case_when()`

]

### Groups

.content-box-green[

* Divide data into groups with `group_by()`
* Collapse many values down to a single summary  with `summarise()` in combination with `group_by()`.

]

---

## dplyr basics


&gt; All verbs (functions) work similarly:
&gt;
&gt; * The first argument is a data frame.
&gt;
&gt; * The subsequent arguments describe what to do with the data frame, using the variable names (without quotes).
&gt;
&gt; * The result is a new data frame.

So in R...


``` r
verb(dataframe, arguments, ...)
```

or with `filter()`


``` r
dplyr::filter(flights, air_time == 100)
```

---
class: inverse, center, middle

# Verbs for Rows

- `filter()`

- `arrange()`

- `drop_na()`

---

## Filter rows with filter()

You can filter rows (i.e. records) of your data frame with the function `filter()`.

&gt; The first argument is the name of the data frame. The second and subsequent arguments are the expressions that filter the data frame. For example, we can select all flights on January 1st with:


``` r
dplyr::filter(flights, month == 1, day == 1)
```

```
## # A tibble: 842 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ℹ 832 more rows
## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

## Filter rows with filter()

Remember that R won't automagically store the resulting, new data frame everywhere. If you don't specify it, your outcome will be lost, as tears in the rain.

.center[
&lt;img src ='https://media.giphy.com/media/7aFDGPdxGLuEg/giphy.gif'&gt;&lt;/img&gt;
]

To save your results, do


``` r
jan1 &lt;- dplyr::filter(flights, month == 1, day == 1)
```

---

## Comparisons

&gt; To use filtering effectively, you have to know how to select the observations that you want using the comparison operators. R provides the standard suite: `&gt;`, `&gt;=`, `&lt;`, `&lt;=`, `!=` (not equal), and `==` (equal).

&gt; When you’re starting out with R, the easiest mistake to make is to use = instead of == when testing for equality. When this happens you’ll get an informative error.


``` r
dplyr::filter(flights, month = 1)
```

---

## Logical operators

You can combine multiple logical comparison in your statement with the following operators:

* `&amp;` is “and”, 

* `|` is “or”, and 

* `!` is “not”.

The code


``` r
dplyr::filter(flights, month == 11 &amp; year == 2013)
```

will filter records where month is `11` but also where year is `2013`.

.content-box-red[

Logical operators are hard (i.e. easy to get wrong). Make sure you always check the results when using them!

]

---

## Filter for multiple values in the same columns

Let's say you want to filter all rows where one column takes either one value OR another value.

For example, let's filter for rows where `sched_dep_time` is either 529 or 600.

### Option 1


``` r
dplyr::filter(flights, sched_dep_time == 529 | sched_dep_time == 545)
```

```
## # A tibble: 542 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      533            529         4      850            830
##  2  2013     1     1      544            545        -1     1004           1022
##  3  2013     1     2      536            529         7      840            828
##  4  2013     1     2      539            545        -6      959           1022
##  5  2013     1     3      543            545        -2     1009           1022
##  6  2013     1     4      608            545        23     1039           1022
##  7  2013     1     5      602            545        17     1035           1022
##  8  2013     1     6      629            545        44     1156           1022
##  9  2013    10     1      536            545        -9      809            855
## 10  2013    10     1      539            545        -6      801            827
## # ℹ 532 more rows
## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

## Filter for multiple values in the same columns

Alternatively, you can use the special operator `%in%`.

`%in%` returns a logical vector indicating if there is a match or not for its left operand.


``` r
1 %in% c(1, 3, 4, 1)
```

```
## [1] TRUE
```


``` r
c(1, 2) %in% c(1, 3, 4, 1)
```

```
## [1]  TRUE FALSE
```

Remember that when operating with dplyr verbs all your operations are vector operations (as you are operating on multiple values across rows or columns).

---

## Filter for multiple values in the same columns

### Option 2


``` r
dplyr::filter(flights, sched_dep_time %in% c(529, 545))
```

```
## # A tibble: 542 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      533            529         4      850            830
##  2  2013     1     1      544            545        -1     1004           1022
##  3  2013     1     2      536            529         7      840            828
##  4  2013     1     2      539            545        -6      959           1022
##  5  2013     1     3      543            545        -2     1009           1022
##  6  2013     1     4      608            545        23     1039           1022
##  7  2013     1     5      602            545        17     1035           1022
##  8  2013     1     6      629            545        44     1156           1022
##  9  2013    10     1      536            545        -9      809            855
## 10  2013    10     1      539            545        -6      801            827
## # ℹ 532 more rows
## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```



---

## Sort rows with arrange()

If you provide more than one column name, each additional column will be used to break ties in the values of preceding columns.


``` r
dplyr::arrange(flights, year, month)
```

```
## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ℹ 336,766 more rows
## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

and with `desc()` I sort rows by the descending order of a variable


``` r
dplyr::arrange(flights, desc(dep_delay))
```

```
## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242           1530
##  2  2013     6    15     1432           1935      1137     1607           2120
##  3  2013     1    10     1121           1635      1126     1239           1810
##  4  2013     9    20     1139           1845      1014     1457           2210
##  5  2013     7    22      845           1600      1005     1044           1815
##  6  2013     4    10     1100           1900       960     1342           2211
##  7  2013     3    17     2321            810       911      135           1020
##  8  2013     6    27      959           1900       899     1236           2226
##  9  2013     7    22     2257            759       898      121           1026
## 10  2013    12     5      756           1700       896     1058           2020
## # ℹ 336,766 more rows
## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---

## Drop missing values with `drop_na()`

If your data frame has any missing value and you like to exclude rows with at least one missing value you can


``` r
my_dat &lt;- data.frame(x = c(1, 2, NA, 4), y = c("a", NA, "b", "d"))
my_dat
```

```
##    x    y
## 1  1    a
## 2  2 &lt;NA&gt;
## 3 NA    b
## 4  4    d
```



``` r
tidyr::drop_na(my_dat)
```

```
##   x y
## 1 1 a
## 2 4 d
```

---
class: inverse, center, middle

# Verbs for Columns
- `select()`
- `mutate()`
- `ifelse()` or `case_when()`


---

## Select columns with select()

If you want to simplify your data frame by keeping only some of the columns (this is useful if your data frame contains many columns).


``` r
dplyr::select(flights, year, month, day)
```

```
## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ℹ 336,766 more rows
```

---

## Select columns with select() while changing their names


``` r
dplyr::select(flights, yr = year, month, day)
```

```
## # A tibble: 336,776 × 3
##       yr month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ℹ 336,766 more rows
```


---

## Create new variables with mutate()

The function `mutate()` will add a new column at the end of your data frame (on the right...). Of course, it is not enough to only name the new column. You also need to specify the content of the new variable.

The most common scenario is to use `mutate()` to transform an existing variable or to operate on two (or more) variables to create a new one. For example, 


``` r
dplyr::mutate(flights,
  gain = dep_delay - arr_delay,
  speed = distance / air_time * 60
)
```

creates two new columns `gain` and `speed`. For example, `gain` is the result of the subtraction of the value `arr_delay` from the value `dep_delay` (again, for each record). So,

.center[
`\(gain_i = dep\_delay_i - arr\_delay_i\)`
]

where `\(i\)` is one of the number of rows. 


---

## Create new variables with `mutate()`


``` r
dplyr::mutate(flights,
* gain = dep_delay - arr_delay,
* speed = distance / air_time * 60)
```


&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; dep_delay &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; arr_delay &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; gain &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; distance &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; air_time &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; speed &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -9 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 1400 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 227 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 370.0441 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -16 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 1416 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 227 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 374.2731 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -31 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 1089 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 160 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 408.3750 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; -18 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; 17 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; 1576 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; 183 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; 516.7213 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -6 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -25 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 762 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 116 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 394.1379 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -4 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -16 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 719 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 150 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 287.6000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -5 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -24 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 1065 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 158 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 404.4304 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -3 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -14 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 229 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 53 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 259.2453 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -3 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -8 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 944 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 140 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 404.5714 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -2 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -10 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 733 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 138 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 318.6957 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

## Create new variables with `mutate()`


``` r
dplyr::mutate(flights,
* mean_delay = (dep_delay + arr_delay) / 2)
```


&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; dep_delay &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; arr_delay &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; mean_delay &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 11 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 6.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 20 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 12.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 17.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; -1 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; -18 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;font-weight: bold;color: white !important;background-color: rgba(215, 38, 30, 255) !important;"&gt; -9.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -6 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -25 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -15.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -4 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 12 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 4.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -5 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 19 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 7.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -3 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -14 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -8.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -3 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -8 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; -5.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; -2 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: lightblue !important;"&gt; 8 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: orange !important;"&gt; 3.0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

### Create new variables by recoding old variables with `ifelse()`

Let's say you have a data frame where sex is encoded as "male" or "female" and instead you want 0 (for male) and 1 (for female)


``` r
my_dat &lt;- data.frame(sex = c("male", "female", "male", "male", NA))
my_dat
```

```
##      sex
## 1   male
## 2 female
## 3   male
## 4   male
## 5   &lt;NA&gt;
```


``` r
dplyr::mutate(my_dat, female = ifelse(sex == "female", 1, 0))
```

```
##      sex female
## 1   male      0
## 2 female      1
## 3   male      0
## 4   male      0
## 5   &lt;NA&gt;     NA
```

---

### Create new variables by recoding old variables with `case_when()`

Let's say you have a more complicated case. 


``` r
my_dat &lt;- data.frame(question_1 = c("yes", "no", "no", "yes", "don't know"))
```

You want to recode "yes" as `1`, "no" as `0` and "don't know" as `NA`. How do you do?

You can use `case_when()` which

&gt; takes pairs that look like `condition ~ output`. condition must be a logical vector; when it’s `TRUE`, `output` will be used. 

---

using `mutate()` you can then


``` r
mutate(my_dat,
       new_question_1 = 
         case_when(question_1 == "yes" ~ 1,
                   question_1 == "no" ~ 0,
                   question_1 == "don't know" ~ NA))
```

```
##   question_1 new_question_1
## 1        yes              1
## 2         no              0
## 3         no              0
## 4        yes              1
## 5 don't know             NA
```

---
class: inverse, center, middle
# Individual in-class quiz/tutorial Part 1
# Until "ifelse() and case_when()" included

---
class: inverse, center, middle

# pipe (`|&gt;`) operator


---

## The pipe (`|&gt;`) operator

Before moving to group operations on data frame now let's introduce the `|&gt;` pipe operator...

The pipe operator, which you type with a `|` + `&gt;`, *chains* function together so that the value returned from the function *on the left* of the `|&gt;` flows as first argument into the function *on the right* of the `|&gt;`.

<div id="htmlwidget-d7b7e5d7479ffc0e2237" style="width:100%;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-d7b7e5d7479ffc0e2237">{"x":{"diagram":"\n  digraph graph2 {\n  \n  graph [layout = dot, rankdir = LR]\n  \n  # node definitions with substituted label text\n  node [shape = box, style = filled]\n  a [label = \"data\"]\n  b [label = \"|>\", shape = oval, fillcolor = Lightblue]\n  c [label = \"fun()\", fillcolor = Orange]\n  d [label = \"|>\", shape = oval, fillcolor = Lightblue]\n  e [label = \"fun()\", fillcolor = Orange]\n  f [label = \"|>\", shape = oval, fillcolor = Lightblue]\n  g [label = \"fun()\", fillcolor = Orange]\n\n  \n  a -> b -> c -> d -> e -> f -> g;\n  }\n  ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

And in R...


``` r
flights |&gt; filter(air_time &lt; 100) |&gt; mutate(new = 1)
```

---

## The pipe (`|&gt;`) operator

The pipe operator doesn't add new functions to your toolbox. But it drastically improves and simplifies how you can write your code. 

Also, with `|&gt;` you don't need to store your results in temporary/intermediary variables. Instead, you define your transformations and you store the results from the entire pipeline of transforming functions.


``` r
my_new_dataframe &lt;- 
* flights |&gt; # Source of data
* filter(air_time &lt; 100) |&gt; # First transformation
* mutate(new = 1) # Second transformation
```

Note that you can improve the readability of your code using a new line for each command separated chained with a `|&gt;`. In this code, after three steps, the results will be stored in the object `my_new_dataframe`.

Also, note that `filter(air_time &lt; 100)` and the other verbs do not specify a data frame (which must be the first argument of `filter()` and `mutate()`) because the data is piped in, top-down, with `|&gt;`.

---

.content-box-yellow[

## `|&gt;` == `%&gt;%`

It is also common to find the pipe operator written as `%&gt;%` (especially in old code). Just remember that `|&gt;` and `%&gt;%` are functionally the same yet `|&gt;` is to be preferred as it doesn't require loading extra packages (it is from the R base package).

]


---
class: inverse, center, middle

# Verbs for Groups

- `group_by()`

- `summarise()`

---

## Grouping rows

&gt; Use `group_by()` to divide your dataset into groups meaningful for your analysis.

&gt; `group_by()` doesn’t change the data but, if you look closely at the output, you’ll notice that the output indicates that it is "grouped by" month (Groups: month [12]). This means subsequent operations will now work “by month”. group_by() adds this grouped feature (referred to as class) to the data frame, which changes the behavior of the subsequent verbs applied to the data.


``` r
dplyr::group_by(flights, month)
```

```
## # A tibble: 336,776 × 19
## # Groups:   month [12]
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
##  1  2013     1     1      517            515         2      830            819
##  2  2013     1     1      533            529         4      850            830
##  3  2013     1     1      542            540         2      923            850
##  4  2013     1     1      544            545        -1     1004           1022
##  5  2013     1     1      554            600        -6      812            837
##  6  2013     1     1      554            558        -4      740            728
##  7  2013     1     1      555            600        -5      913            854
##  8  2013     1     1      557            600        -3      709            723
##  9  2013     1     1      557            600        -3      838            846
## 10  2013     1     1      558            600        -2      753            745
## # ℹ 336,766 more rows
## # ℹ 11 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```



---

## Grouped summaries with summarise()

The verb `summarise()` "collapses a data frame to a single row".


``` r
dplyr::summarise(flights, delay = mean(dep_delay, na.rm = TRUE))
```

```
## # A tibble: 1 × 1
##   delay
##   &lt;dbl&gt;
## 1  12.6
```

Great, it doesn't look that `dplyr::summarise()` does much than simply `mean(flights$dep_delay, na.rm = TRUE)`... 

Indeed! `dplyr::summarise()` is only useful after `group_by()`!

.footnote[Note: We already introduced the function `mean()`, which as expected returned the mean of a vector of numbers. Here `mean()` takes an additional argument `na.rm = TRUE`. It simply tells the function to disregard all the missing values (`NA`) while computing the mean. By default, `mean` will do `na.rm = FALSE)` - and with this setting, the presence of a single `NA` in your vector will force `mean()` to return `NA`. ]

---

## Grouped summaries with `group_by()` and `summarise()` and pipes `|&gt;`.

Let's say for each day, we want to summarise the average delay.


``` r
flights |&gt;
* group_by(year, month, day) |&gt;
* summarise(delay = mean(dep_delay, na.rm = TRUE))
```

```
## # A tibble: 365 × 4
## # Groups:   year, month [12]
##     year month   day delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # ℹ 355 more rows
```

---

## Grouped summaries with `group_by()` and `summarise()` and pipes `|&gt;`.

Let's take another example:


``` r
us_population_by_county &lt;- 
  read.csv("https://raw.githubusercontent.com/fraba/SSPS4102/master/data/US-pop-by-county.csv")
nrow(us_population_by_county)
```

```
## [1] 3142
```


|county          |state          | population|
|:---------------|:--------------|----------:|
|Fulton County   |New York       |      55531|
|Posey County    |Indiana        |      25910|
|Johnston County |North Carolina |     168878|
|LaMoure County  |North Dakota   |       4139|
|Laramie County  |Wyoming        |      91738|

---

## Grouped summaries with `group_by()` and `summarise()` and pipes `|&gt;`.

Let's sum the population of each state


``` r
us_population_by_county |&gt;
* dplyr::group_by(state) |&gt;
* dplyr::summarise(us_population_by_state, sum(...))
```

What we replace `...` with to get the `sum()` of the population for each **state**?

---

## Grouped summaries with `group_by()` and `summarise()` and pipes `|&gt;`.

Let's say that you have a non-numeric variable (character or factor). How can you summarise it? You can use `count()` on your grouped data frame. 


``` r
us_population_by_county |&gt;
  dplyr::group_by(state) |&gt;
  dplyr::count()
```

```
## # A tibble: 51 × 2
## # Groups:   state [51]
##    state                       n
##    &lt;chr&gt;                   &lt;int&gt;
##  1 " Alabama"                 67
##  2 " Alaska"                  29
##  3 " Arizona"                 15
##  4 " Arkansas"                75
##  5 " California"              58
##  6 " Colorado"                64
##  7 " Connecticut"              8
##  8 " Delaware"                 3
##  9 " District of Columbia"     1
## 10 " Florida"                 67
## # ℹ 41 more rows
```

---
class: inverse, center, middle

# Piping all together with `|&gt;`

---

## Piping all together with `|&gt;`: Example 1


``` r
us_population_by_county |&gt;
  dplyr::group_by(state) |&gt;
  dplyr::summarise(tot_pop = sum(population / 1000000),
                   mean_pop = mean(population / 1000))
```

```
## # A tibble: 51 × 3
##    state                   tot_pop mean_pop
##    &lt;chr&gt;                     &lt;dbl&gt;    &lt;dbl&gt;
##  1 " Alabama"                4.78      71.3
##  2 " Alaska"                 0.710     24.5
##  3 " Arizona"                6.39     426. 
##  4 " Arkansas"               2.92      38.9
##  5 " California"            37.3      642. 
##  6 " Colorado"               5.03      78.6
##  7 " Connecticut"            3.57     447. 
##  8 " Delaware"               0.898    299. 
##  9 " District of Columbia"   0.602    602. 
## 10 " Florida"               18.8      281. 
## # ℹ 41 more rows
```

What is `mean_pop`?

---

## Piping all together with `|&gt;`: Example 2



``` r
us_population_by_county |&gt;
  dplyr::group_by(state) |&gt;
  dplyr::summarise(tot_pop = sum(population / 1000000),
                   mean_pop = mean(population / 1000)) |&gt;
  ggplot(aes(x = state, y = tot_pop)) +
  geom_col() + 
  theme(axis.text.x = element_text(angle = 90))
```

&lt;img src="week-05_files/figure-html/unnamed-chunk-52-1.svg" width="100%" style="display: block; margin: auto;" /&gt;

.footnote[`theme(axis.text.x = element_text(angle = 90))` rotate the text of the axis X label by 90 degrees]

---
class: inverse, center, middle

# Individual in-class quiz/tutorial Part 2

---
class: inverse, center, middle

# Something more on Rmd (to make your document look better)

---

- Print your data frame as a nice table
  

``` r
data |&gt;
  dplyr::filter(x == "something") |&gt;
  knitr::kable()
```

- Include a figure in your document


``` r
knitr::include_graphics("path/to/image.jpg")
```

---

- Remove all your code from the final output


``` r
# Set echo = FALSE in your first (setup) chunk
knitr::opts_chunk$set(echo = FALSE)
```

- Resize your plots (also if font-size is too small)


``` r
# Use this option with the {} at the beginning
# of your chunk
fig.width=8, fig.height=4
```

---
class: inverse, center, middle

# Group in-class problem set


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="assets/remark-zoom.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "4:3",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
