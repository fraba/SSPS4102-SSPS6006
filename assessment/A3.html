<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2026-02-12">

<title>Assessment 3: Data Preparation and Communication</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="A3_files/libs/clipboard/clipboard.min.js"></script>
<script src="A3_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="A3_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="A3_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="A3_files/libs/quarto-html/popper.min.js"></script>
<script src="A3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="A3_files/libs/quarto-html/anchor.min.js"></script>
<link href="A3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="A3_files/libs/quarto-html/quarto-syntax-highlighting-1504405cf30eebad8219e9a93a0cd974.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="A3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="A3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="A3_files/libs/bootstrap/bootstrap-5596f66420dd5ca01d3abb770117dec8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task">Task</a></li>
  <li><a href="#report-structure" id="toc-report-structure" class="nav-link" data-scroll-target="#report-structure">Report structure</a></li>
  <li><a href="#r-programming-tips" id="toc-r-programming-tips" class="nav-link" data-scroll-target="#r-programming-tips">R programming tips</a></li>
  <li><a href="#submission" id="toc-submission" class="nav-link" data-scroll-target="#submission">Submission</a></li>
  <li><a href="#marking-criteria" id="toc-marking-criteria" class="nav-link" data-scroll-target="#marking-criteria">Marking criteria</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assessment 3: Data Preparation and Communication</h1>
<p class="subtitle lead">SSPS4102 Data Analytics in the Social Sciences<br>SSPS6006 Data Analytics for Social Research</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 12, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-simple callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Draft
</div>
</div>
<div class="callout-body-container callout-body">
<p>This assessment description is still in <strong>draft form</strong> and may be slightly revised before Week 01.</p>
</div>
</div>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>In this assessment, you will demonstrate your ability to import, clean, and prepare survey data using R, and to communicate your findings effectively through descriptive statistics, tables, and visualisations. You will work with data from <strong>Round 9 (2021–2023) of the Afrobarometer</strong>, a continent-wide survey conducted across 39 African countries.</p>
<p><strong>Weight:</strong> 30% of final grade</p>
<p><strong>Length:</strong> 1,000 words (as measured in the Quarto source document, excluding code)</p>
<p><strong>AI use:</strong> Permitted (see AI use policy on Canvas)</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>The dataset and codebook for this assessment are available for download from the links below.</p>
<ul>
<li><strong>Dataset (SPSS format):</strong> <a href="https://www.afrobarometer.org/wp-content/uploads/2025/06/R9.Merge_39ctry.20Nov23.final_.release_Updated.4Jun25-3.sav">Download .sav file</a></li>
<li><strong>Codebook (PDF):</strong> <a href="https://www.afrobarometer.org/wp-content/uploads/2025/07/AB_R9.MergeCodebook_25Jun24.final_.pdf">Download codebook</a></li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Before you begin
</div>
</div>
<div class="callout-body-container callout-body">
<p>Download both files and place them in your R project folder. You will need the <strong>codebook</strong> to identify relevant variables, understand their coding, and decide how to recode them for your analysis.</p>
</div>
</div>
</section>
<section id="task" class="level2">
<h2 class="anchored" data-anchor-id="task">Task</h2>
<p>Using the Afrobarometer Round 9 merged dataset, you will investigate <strong>trust in institutions</strong> across selected African countries. Your task is to construct a composite index of institutional trust, describe its components, and compare the index across countries.</p>
<section id="subtasks" class="level3">
<h3 class="anchored" data-anchor-id="subtasks">Subtasks</h3>
<ol type="1">
<li><p><strong>Construct a composite index</strong> named <code>trust_institutions_index</code> in your code:</p>
<ol type="a">
<li><p>Using the codebook, identify and list <strong>at least three survey variables</strong> that measure trust in institutions. The Afrobarometer questionnaire includes a number of questions on trust — these span multiple parts of the survey (e.g., trust in state institutions, trust in political actors, trust in security and judicial bodies). Explore the codebook carefully to find variables that are conceptually related and suitable for combining into a single index.</p></li>
<li><p>Inspect each variable using <code>haven::print_labels()</code> and discuss the original coding of each variable (value–label mapping).</p></li>
<li><p><strong>Recode</strong> the variables as needed so that they are suitable for quantitative analysis (e.g., set non-substantive responses to <code>NA</code>; ensure that higher values consistently indicate greater trust).</p></li>
<li><p><strong>Justify</strong> your choice of variables: explain briefly why you selected these particular variables and why they belong together in an index of institutional trust.</p></li>
<li><p>Construct the index by <strong>averaging</strong> your recoded variables for each respondent.</p></li>
</ol></li>
<li><p><strong>Select three or more countries</strong> from the dataset for comparative analysis.</p></li>
</ol>
</section>
</section>
<section id="report-structure" class="level2">
<h2 class="anchored" data-anchor-id="report-structure">Report structure</h2>
<p>Your report should include the following sections.</p>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">1. Introduction</h3>
<p>Briefly introduce the Afrobarometer dataset, the round and year of the survey, the countries you selected, and the research question you are addressing.</p>
</section>
<section id="variable-description" class="level3">
<h3 class="anchored" data-anchor-id="variable-description">2. Variable description</h3>
<p>For each source variable used in your index:</p>
<ul>
<li>Describe what the variable measures.</li>
<li>Report appropriate descriptive statistics (minimum, maximum, mean, median, standard deviation, number of valid observations).</li>
<li>Discuss the variable type (e.g., ordinal, categorical) and any recoding or transformations you applied, explaining <em>why</em> these were necessary.</li>
</ul>
</section>
<section id="index-description-and-cross-country-comparison" class="level3">
<h3 class="anchored" data-anchor-id="index-description-and-cross-country-comparison">3. Index description and cross-country comparison</h3>
<p>Using both visualisations and written discussion:</p>
<ul>
<li>Describe the distribution of <code>trust_institutions_index</code> for each of your selected countries separately (e.g., using histograms, density plots, or boxplots).</li>
<li>Compare the distributions across countries. Do they look similar or different? What patterns do you observe?</li>
</ul>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">4. Conclusion</h3>
<p>Provide a brief general comment on how trust in institutions compares across your selected countries.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>All code must be visible in your final PDF (<code>echo: true</code>). Your report must be fully reproducible — that is, it must render without errors from the <code>.qmd</code> source file and the data included in your project folder.</p>
</div>
</div>
</section>
</section>
<section id="r-programming-tips" class="level2">
<h2 class="anchored" data-anchor-id="r-programming-tips">R programming tips</h2>
<section id="reading-an-spss-data-file" class="level3">
<h3 class="anchored" data-anchor-id="reading-an-spss-data-file">Reading an SPSS data file</h3>
<p>Survey responses are stored in an SPSS data file (<code>.sav</code>). To import the file into your R session, use the <code>haven</code> package:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>afrobarometer_r9 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"afrobarometer_r9.sav"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure the <code>.sav</code> file is saved inside your R project folder and that the filename in your code matches the actual filename exactly.</p>
</div>
</div>
</section>
<section id="inspecting-labelled-variables" class="level3">
<h3 class="anchored" data-anchor-id="inspecting-labelled-variables">Inspecting labelled variables</h3>
<p>Most variables in the dataset are of type <code>double</code> and are labelled. Before using any variable, inspect its value–label mapping using <code>haven::print_labels()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>haven<span class="sc">::</span><span class="fu">print_labels</span>(afrobarometer_r9<span class="sc">$</span>Q37A)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This will show you output similar to:</p>
<pre><code>Labels:
 value                           label
    -1                         Missing
     0                      Not at all
     1                   Just a little
     2                        Somewhat
     3                           A lot
     8                         Refused
     9 Don't know/Haven't heard enough</code></pre>
<p>Note that not all variables use the same coding scheme. Always check the labels before recoding.</p>
</section>
<section id="recoding-labelled-variables" class="level3">
<h3 class="anchored" data-anchor-id="recoding-labelled-variables">Recoding labelled variables</h3>
<p>To convert a labelled variable into a factor (where numeric values are replaced by their character labels), use:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>haven<span class="sc">::</span><span class="fu">as_factor</span>(afrobarometer_r9<span class="sc">$</span>Q37A)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>To use a labelled variable as a quantitative variable (e.g., for computing a mean), you will typically need to set non-substantive responses (such as “Don’t know”, “Refused”, and “Missing”) to <code>NA</code>. You can do this with <code>dplyr::if_else()</code> or <code>dplyr::case_when()</code>. For example:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>afrobarometer_r9 <span class="ot">&lt;-</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  afrobarometer_r9 <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q37A_clean =</span> <span class="fu">if_else</span>(Q37A <span class="sc">%in%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">9</span>), <span class="cn">NA_real_</span>, Q37A)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Check every variable
</div>
</div>
<div class="callout-body-container callout-body">
<p>The numeric codes for non-substantive responses may differ across variables. Always use <code>haven::print_labels()</code> to check each variable individually before recoding.</p>
</div>
</div>
</section>
<section id="filtering-by-country" class="level3">
<h3 class="anchored" data-anchor-id="filtering-by-country">Filtering by country</h3>
<p>To filter the dataset for specific countries, use the <code>COUNTRY</code> variable:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>selected_countries <span class="ot">&lt;-</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  afrobarometer_r9 <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(haven<span class="sc">::</span><span class="fu">as_factor</span>(COUNTRY) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Nigeria"</span>, <span class="st">"Kenya"</span>, <span class="st">"South Africa"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="creating-an-index-by-averaging-variables" class="level3">
<h3 class="anchored" data-anchor-id="creating-an-index-by-averaging-variables">Creating an index by averaging variables</h3>
<p>Once you have created clean versions of your selected variables, you can compute a row-wise average using <code>rowMeans()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>selected_countries <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  selected_countries <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">trust_institutions_index =</span> <span class="fu">rowMeans</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pick</span>(var1_clean, var2_clean, var3_clean),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Replace <code>var1_clean</code>, <code>var2_clean</code>, <code>var3_clean</code> with the names of your own recoded variables.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember to load all required packages at the top of your <code>.qmd</code> document. At a minimum, you will need <code>haven</code>, <code>dplyr</code>, and <code>ggplot2</code>.</p>
</div>
</div>
</section>
</section>
<section id="submission" class="level2">
<h2 class="anchored" data-anchor-id="submission">Submission</h2>
<p>You are expected to submit the following items on Canvas:</p>
<ol type="1">
<li><p><strong>Your report</strong> — Render your report into a <strong>PDF</strong> from the source <code>.qmd</code> document. Ensure that all code chunks have <code>echo: true</code> so that your R code is visible in the final PDF.</p></li>
<li><p><strong>Your R project folder</strong> — Compress your project folder into a <code>.zip</code> file. The folder must include:</p>
<ul>
<li>Your <code>.qmd</code> source document</li>
<li>The data file (<code>.sav</code>)</li>
<li>Your <code>.Rproj</code> file</li>
</ul></li>
</ol>
</section>
<section id="marking-criteria" class="level2">
<h2 class="anchored" data-anchor-id="marking-criteria">Marking criteria</h2>
<p>Your submission will be assessed on the following criteria.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Criterion</th>
<th>Weight</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Data import and preparation</strong></td>
<td>25%</td>
<td>Correct importing, inspection, and recoding of variables; appropriate handling of missing values</td>
</tr>
<tr class="even">
<td><strong>Descriptive statistics</strong></td>
<td>20%</td>
<td>Accurate and relevant summary statistics for source variables</td>
</tr>
<tr class="odd">
<td><strong>Visualisation</strong></td>
<td>25%</td>
<td>Effective and well-labelled graphs that support the analysis</td>
</tr>
<tr class="even">
<td><strong>Written communication</strong></td>
<td>20%</td>
<td>Clear, concise interpretation of results; appropriate use of statistical language; justified variable selection</td>
</tr>
<tr class="odd">
<td><strong>Reproducibility</strong></td>
<td>10%</td>
<td>Code runs without errors; project folder is well-organised; document renders correctly</td>
</tr>
</tbody>
</table>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>